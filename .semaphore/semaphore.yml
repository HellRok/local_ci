---
version: v1.0
name: CI
agent:
  machine:
    type: f1-standard-2
    os_image: ubuntu2404
blocks:
- name: Linting
  task:
    jobs:
    - name: StandardRB
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:linting:jobs:standardrb
- name: Specs
  task:
    jobs:
    - name: RSpec
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:specs:jobs:rspec
    - name: RSpec - plain
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:specs:jobs:rspec__plain
    - name: RSpec - json
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:specs:jobs:rspec__json
    - name: RSpec - realtime
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:specs:jobs:rspec__realtime
- name: '386: MRI Ruby'
  task:
    jobs:
    - name: Ruby 4.0
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:386_mri_ruby:jobs:ruby_40
    - name: Ruby 3.4
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:386_mri_ruby:jobs:ruby_34
    - name: Ruby 3.3
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:386_mri_ruby:jobs:ruby_33
    - name: Ruby 3.2
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:386_mri_ruby:jobs:ruby_32
    - name: Ruby 3.1
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:386_mri_ruby:jobs:ruby_31
    - name: Ruby 3.0
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:386_mri_ruby:jobs:ruby_30
    - name: Ruby 2.7
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:386_mri_ruby:jobs:ruby_27
- name: 'amd64: MRI Ruby'
  task:
    jobs:
    - name: Ruby 4.0
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:amd64_mri_ruby:jobs:ruby_40
    - name: Ruby 3.4
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:amd64_mri_ruby:jobs:ruby_34
    - name: Ruby 3.3
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:amd64_mri_ruby:jobs:ruby_33
    - name: Ruby 3.2
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:amd64_mri_ruby:jobs:ruby_32
    - name: Ruby 3.1
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:amd64_mri_ruby:jobs:ruby_31
    - name: Ruby 3.0
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:amd64_mri_ruby:jobs:ruby_30
    - name: Ruby 2.7
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:amd64_mri_ruby:jobs:ruby_27
- name: 'arm/v7: MRI Ruby'
  task:
    jobs:
    - name: Ruby 4.0
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:armv7_mri_ruby:jobs:ruby_40
    - name: Ruby 3.4
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:armv7_mri_ruby:jobs:ruby_34
    - name: Ruby 3.3
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:armv7_mri_ruby:jobs:ruby_33
    - name: Ruby 3.2
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:armv7_mri_ruby:jobs:ruby_32
    - name: Ruby 3.1
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:armv7_mri_ruby:jobs:ruby_31
    - name: Ruby 3.0
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:armv7_mri_ruby:jobs:ruby_30
    - name: Ruby 2.7
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:armv7_mri_ruby:jobs:ruby_27
- name: 'arm64: MRI Ruby'
  task:
    jobs:
    - name: Ruby 4.0
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:arm64_mri_ruby:jobs:ruby_40
    - name: Ruby 3.4
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:arm64_mri_ruby:jobs:ruby_34
    - name: Ruby 3.3
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:arm64_mri_ruby:jobs:ruby_33
    - name: Ruby 3.2
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:arm64_mri_ruby:jobs:ruby_32
    - name: Ruby 3.1
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:arm64_mri_ruby:jobs:ruby_31
    - name: Ruby 3.0
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:arm64_mri_ruby:jobs:ruby_30
    - name: Ruby 2.7
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:arm64_mri_ruby:jobs:ruby_27
- name: 'amd64: JRuby'
  task:
    jobs:
    - name: 'amd64: JRuby'
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:amd64_jruby
- name: 'arm64: JRuby'
  task:
    jobs:
    - name: 'arm64: JRuby'
      commands:
      - checkout
      - bundle check &> /dev/null || bundle install
      - bundle exec rake ci:arm64_jruby
